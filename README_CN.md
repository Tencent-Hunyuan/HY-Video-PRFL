# HY-Video-PRFL

<div align="center">
  <img src="assets/logo.svg"  height=100>

# âš¡ HY-Video-PRFL: è§†é¢‘ç”Ÿæˆæ¨¡å‹æ˜¯ä¼˜ç§€çš„æ½œåœ¨å¥–åŠ±æ¨¡å‹

</div>

è§†é¢‘ç”Ÿæˆæ¨¡å‹æ—¢èƒ½åˆ›é€ ä¹Ÿèƒ½è¯„ä¼°â€”â€”æˆ‘ä»¬ä½¿14Bæ¨¡å‹èƒ½å¤Ÿåœ¨67GBæ˜¾å­˜å†…å®Œæˆå®Œæ•´çš„720PÃ—81å¸§åè®­ç»ƒï¼Œç›¸æ¯”ä¼ ç»Ÿæ–¹æ³•å®ç°1.5å€çš„é€Ÿåº¦æå‡å’Œ56%çš„è¿åŠ¨è´¨é‡æ”¹è¿›ã€‚

<div align="center">
  <a href="https://github.com/Tencent-Hunyuan/HY-Video-PRFL"><img src="https://img.shields.io/static/v1?label=HY-Video-PRFL%20Code&message=Github&color=blue"></a> &ensp;
  <a href="https://hy-video-prfl.github.io/HY-VIDEO-PRFL/"><img src="https://img.shields.io/static/v1?label=Project%20Page&message=Web&color=green"></a> &ensp;
  <a href="https://arxiv.org/pdf/2511.21541"><img src="https://img.shields.io/badge/ArXiv-2511.21541-red"></a> &ensp;
</div>

<br>

![image](assets/teaser.jpg)

> [**HY-Video-PRFL: è§†é¢‘ç”Ÿæˆæ¨¡å‹æ˜¯ä¼˜ç§€çš„æ½œåœ¨å¥–åŠ±æ¨¡å‹**](https://arxiv.org/pdf/2511.21541)

## ğŸ”¥ğŸ”¥ğŸ”¥ æœ€æ–°åŠ¨æ€ï¼

* **2025å¹´12æœˆ7æ—¥**: ğŸ‘‹ æˆ‘ä»¬å‘å¸ƒäº†HY-Video-PRFLçš„è®­ç»ƒå’Œæ¨ç†ä»£ç ã€‚
* **2025å¹´11æœˆ26æ—¥**: ğŸ‘‹ æˆ‘ä»¬å‘å¸ƒäº†è®ºæ–‡å’Œé¡¹ç›®ä¸»é¡µã€‚[[è®ºæ–‡](https://arxiv.org/pdf/2511.21541)] [[é¡¹ç›®ä¸»é¡µ](https://hy-video-prfl.github.io/HY-VIDEO-PRFL/)]

## ğŸ“‘ å¼€æºè®¡åˆ’

- HY-Video-PRFL
  - [x] PAVRMçš„è®­ç»ƒå’Œæ¨ç†ä»£ç 
  - [x] PRFLçš„è®­ç»ƒå’Œæ¨ç†ä»£ç 
  
## ğŸ“‹ ç›®å½•

- [ğŸ”¥ğŸ”¥ğŸ”¥ æœ€æ–°åŠ¨æ€ï¼](#-æœ€æ–°åŠ¨æ€)
- [ğŸ“‘ å¼€æºè®¡åˆ’](#-å¼€æºè®¡åˆ’)
- [ğŸ“– æ‘˜è¦](#-æ‘˜è¦)
- [ğŸ—ï¸ æ¨¡å‹æ¶æ„](#ï¸-æ¨¡å‹æ¶æ„)
- [ğŸ“Š æ€§èƒ½è¡¨ç°](#-æ€§èƒ½è¡¨ç°)
- [ğŸ¬ æ¡ˆä¾‹å±•ç¤º](#-æ¡ˆä¾‹å±•ç¤º)
- [ğŸ“œ ç¯å¢ƒè¦æ±‚](#-ç¯å¢ƒè¦æ±‚)
- [ğŸ› ï¸ å®‰è£…](#ï¸-å®‰è£…)
- [ğŸ§± ä¸‹è½½æ¨¡å‹](#-ä¸‹è½½æ¨¡å‹)
- [ğŸ“ è®­ç»ƒ](#-è®­ç»ƒ)
- [ğŸš€ æ¨ç†](#-æ¨ç†)
- [ğŸ“ å¼•ç”¨](#-å¼•ç”¨)
- [ğŸ™ è‡´è°¢](#-è‡´è°¢)

## ğŸ“– æ‘˜è¦

å¥–åŠ±åé¦ˆå­¦ä¹ ï¼ˆReFLï¼‰å·²è¢«è¯æ˜èƒ½æœ‰æ•ˆåœ°ä½¿å›¾åƒç”Ÿæˆä¸äººç±»åå¥½ä¿æŒä¸€è‡´ã€‚ç„¶è€Œï¼Œå°†å…¶æ‰©å±•åˆ°è§†é¢‘ç”Ÿæˆé¢ä¸´ç€é‡å¤§æŒ‘æˆ˜ã€‚ç°æœ‰çš„è§†é¢‘å¥–åŠ±æ¨¡å‹ä¾èµ–äºä¸ºåƒç´ ç©ºé—´è¾“å…¥è®¾è®¡çš„è§†è§‰-è¯­è¨€æ¨¡å‹ï¼Œåœ¨è®¡ç®—æˆæœ¬é«˜æ˜‚çš„VAEè§£ç åï¼Œå°†ReFLä¼˜åŒ–é™åˆ¶åœ¨æ¥è¿‘å®Œæˆçš„å»å™ªæ­¥éª¤ã€‚

**HY-Video-PRFL** å¼•å…¥äº†**è¿‡ç¨‹å¥–åŠ±åé¦ˆå­¦ä¹ ï¼ˆPRFLï¼‰**ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œå…¨åœ¨æ½œåœ¨ç©ºé—´ä¸­è¿›è¡Œåå¥½ä¼˜åŒ–çš„æ¡†æ¶ã€‚æˆ‘ä»¬è¯æ˜äº†é¢„è®­ç»ƒçš„è§†é¢‘ç”Ÿæˆæ¨¡å‹å¤©ç„¶é€‚åˆåœ¨å™ªå£°æ½œåœ¨ç©ºé—´ä¸­è¿›è¡Œå¥–åŠ±å»ºæ¨¡ï¼Œä½¿å¾—èƒ½å¤Ÿåœ¨æ•´ä¸ªå»å™ªé“¾ä¸­è¿›è¡Œé«˜æ•ˆçš„æ¢¯åº¦åå‘ä¼ æ’­ï¼Œè€Œæ— éœ€VAEè§£ç ã€‚

**æ ¸å¿ƒä¼˜åŠ¿:**
- âœ… é«˜æ•ˆçš„æ½œåœ¨ç©ºé—´ä¼˜åŒ–
- âœ… æ˜¾è‘—çš„å†…å­˜èŠ‚çœ
- âœ… ç›¸æ¯”RGB ReFLå¿«1.4å€çš„è®­ç»ƒé€Ÿåº¦
- âœ… æ›´å¥½åœ°ä¸äººç±»åå¥½ä¿æŒä¸€è‡´

## ğŸ—ï¸ æ¨¡å‹æ¶æ„

![image](assets/method.png)

**ä¼ ç»Ÿçš„RGB ReFL** ä¾èµ–äºä¸ºåƒç´ ç©ºé—´è¾“å…¥è®¾è®¡çš„è§†è§‰-è¯­è¨€æ¨¡å‹ï¼Œéœ€è¦æ˜‚è´µçš„VAEè§£ç ï¼Œå¹¶å°†ä¼˜åŒ–é™åˆ¶åœ¨åæœŸå»å™ªæ­¥éª¤ã€‚

**æˆ‘ä»¬çš„PRFLæ–¹æ³•** åˆ©ç”¨é¢„è®­ç»ƒçš„è§†é¢‘ç”Ÿæˆæ¨¡å‹ä½œä¸ºå™ªå£°æ½œåœ¨ç©ºé—´ä¸­çš„å¥–åŠ±æ¨¡å‹ã€‚è¿™å®ç°äº†ï¼š
- æ— éœ€VAEè§£ç çš„å…¨é“¾æ¢¯åº¦åå‘ä¼ æ’­
- é’ˆå¯¹è¿åŠ¨åŠ¨æ€å’Œç»“æ„ä¸€è‡´æ€§çš„æ—©æœŸç›‘ç£
- å¤§å¹…å‡å°‘å†…å­˜æ¶ˆè€—å’Œè®­ç»ƒæ—¶é—´

## ğŸ“Š æ€§èƒ½è¡¨ç°

### å®šé‡ç»“æœ

æˆ‘ä»¬çš„å®éªŒè¡¨æ˜ï¼ŒPRFLåœ¨è¿åŠ¨è´¨é‡æ–¹é¢å®ç°äº†æ˜¾è‘—æ”¹è¿›ï¼ˆåŠ¨æ€åº¦æå‡+56.00ï¼Œäººä½“è§£å‰–ç»“æ„æå‡+21.52ï¼Œå¹¶ä¸”ä¸äººç±»åå¥½æœ‰æ›´å¥½çš„å¯¹é½ï¼‰ï¼ŒåŒæ—¶åœ¨æ•ˆç‡æ–¹é¢ä¹Ÿå–å¾—äº†æ˜¾è‘—æå‡ï¼ˆè‡³å°‘å¿«1.4å€çš„è®­ç»ƒé€Ÿåº¦å’Œæ˜¾è‘—çš„å†…å­˜èŠ‚çœï¼‰ã€‚

#### æ–‡æœ¬ç”Ÿæˆè§†é¢‘ç»“æœ
![image](assets/T2V_exp.png)

#### å›¾åƒç”Ÿæˆè§†é¢‘ç»“æœ
![image](assets/I2V_exp.png)

#### æ•ˆç‡å¯¹æ¯”
<img src="assets/efficiency.png" width="50%">

## ğŸ¬ æ¡ˆä¾‹å±•ç¤º

### æ–‡æœ¬ç”Ÿæˆè§†é¢‘

|480P åˆ†è¾¨ç‡|720P åˆ†è¾¨ç‡|
|---|---|
|<video src="https://github.com/user-attachments/assets/eed8d875-4b0d-43ec-b013-f0d10c2e107a" width="600" controls autoplay loop></video> <details><summary>ğŸ“‹ å±•ç¤ºæç¤ºè¯</summary>```Two shirtless men with short dark hair are sparring in a dimly lit room. They are both wearing boxing gloves, one red and one black. One man is wearing white shorts while the other is wearing black shorts. There are several screens on the wall displaying images of buildings and people.```</details>|<video src="https://github.com/user-attachments/assets/4871a9f9-9b15-4065-8680-1c8059242707" width="600" controls autoplay loop></video> <details><summary>ğŸ“‹ å±•ç¤ºæç¤ºè¯</summary>```A woman with fair skin, dark hair tied back, and wearing a light green t-shirt is visible against a gray background. She uses both hands to apply a white substance from below her eyes upward onto her face. Her mouth is slightly open as she spreads the cream.```</details>|
|<video src="https://github.com/user-attachments/assets/27296444-973b-4815-b103-5a2ee06404db" width="600" controls autoplay loop></video> <details><summary>ğŸ“‹ å±•ç¤ºæç¤ºè¯</summary>```The woman has dark eyes and is holding a black smartphone to her ear with her right hand. She is typing on the keyboard of an open silver laptop computer with her left hand. Her fingers have blue nail polish. She is sitting in front of a window covered by sheer white curtains.```</details>|<video src="https://github.com/user-attachments/assets/430ff1ca-63ae-4a67-b6fb-b010c7ceec29" width="600" controls autoplay loop></video> <details><summary>ğŸ“‹ å±•ç¤ºæç¤ºè¯</summary>```A light-skinned man with short hair wearing a yellow baseball cap, plaid shirt, and blue overalls stands in a field of sunflowers. He holds a cut sunflower head in his left hand and touches it with his right index finger. Several other sunflowers are visible in the background, some facing away from the camera.```</details>|

### å›¾åƒç”Ÿæˆè§†é¢‘

|480P åˆ†è¾¨ç‡|720P åˆ†è¾¨ç‡|
|---|---|
|<img src="assets/videos/more/14_seed_876367.jpg" width="600">|<img src="assets/videos/more/109_seed_677347.jpg" width="600">|
|<video src="https://github.com/user-attachments/assets/956f5f64-1680-45a0-8666-9fda8e253017" width="600" controls autoplay loop></video> <details><summary>ğŸ“‹ å±•ç¤ºæç¤ºè¯</summary>```A monochromatic video capturing a cat's gaze into the camera```</details>|<video src="https://github.com/user-attachments/assets/8dfeb1ae-8b9c-45aa-899a-3b48903629f9" width="600" controls autoplay loop></video> <details><summary>ğŸ“‹ å±•ç¤ºæç¤ºè¯</summary>```A young boy is jumping in the mud```</details>|
|<img src="assets/videos/more/artlist_video_60ca5873a5c21ff4e4785b1997239d87_seed_561368.jpg" width="600">|<img src="assets/videos/more/real_1246_seed_277973.jpg" width="600">|
<video src="https://github.com/user-attachments/assets/d6d48d0c-cca5-4bdc-95c7-6a2858679111" width="600" controls autoplay loop></video> <details><summary>ğŸ“‹ å±•ç¤ºæç¤ºè¯</summary>```A family of four eats fast food at a table.```</details>| <video src="https://github.com/user-attachments/assets/f39d3382-5430-412d-999e-c4c108835b6c" width="600" controls autoplay loop></video> <details><summary>ğŸ“‹ å±•ç¤ºæç¤ºè¯</summary>```Normal speed, Medium shot, Eye level angle, Third person viewpoint, Static camera movement, Frame-within-frame composition, Shallow depth of field, Natural light, Cinematic style, Desaturated palette with slate blue, dusty rose, and dark wood tones color palette, Dramatic atmosphere. The scene is set on a patio or veranda, framed by a stone archway. In the back, there is a large, weathered wooden gate set into a stone wall. Six people are gathered on a stone patio in front of a large wooden gate. On the right, two men are seated at a dark wooden table. An older man in a grey traditional jacket holds a cane and gestures with his right hand while speaking. A younger man in a light grey suit sits beside him, listening. On the left side of the frame, a man in a dark suit stands with his back to the camera. Next to him, a woman in a pink patterned cheongsam and a woman in a grey skirt suit are standing close together, whispering. The women then turn and smile towards the men at the table. The man in the dark suit turns to face the group, revealing a newborn baby cradled in his arms, wrapped in a pink blanket. He takes a few steps forward, holding the baby. The women look at him and the infant. The older man at the table continues to talk, now gesturing towards the man with the baby. The man holding the baby looks down at the infant as he continues to walk slowly. The table is set with white cups, plates, fruit, and a dark wooden box.```</details>|


## ğŸ“œ ç¯å¢ƒè¦æ±‚

### ç¡¬ä»¶è¦æ±‚

æˆ‘ä»¬å»ºè®®ä½¿ç”¨è‡³å°‘80GBæ˜¾å­˜çš„GPUä»¥è·å¾—æ›´å¥½çš„ç”Ÿæˆè´¨é‡ã€‚

### è½¯ä»¶è¦æ±‚

* **æ“ä½œç³»ç»Ÿ**: Linux
* **CUDA**: 12.4

## ğŸ› ï¸ å®‰è£…

### æ­¥éª¤1: å…‹éš†ä»“åº“
```bash
git clone https://github.com/Tencent-Hunyuan/HY-Video-PRFL.git
cd HY-Video-PRFL
```

### æ­¥éª¤2: è®¾ç½®ç¯å¢ƒ

æˆ‘ä»¬æ¨èä½¿ç”¨CUDA 12.4ç‰ˆæœ¬è¿›è¡Œå®‰è£…ã€‚Condaçš„å®‰è£…è¯´æ˜å¯åœ¨[è¿™é‡Œ](https://www.anaconda.com/docs/main)æ‰¾åˆ°ã€‚

```bash
# åˆ›å»ºcondaç¯å¢ƒ
conda create -n HY-Video-PRFL python==3.10

# æ¿€æ´»ç¯å¢ƒ
conda activate HY-Video-PRFL

# å®‰è£…PyTorchå’Œä¾èµ–é¡¹ï¼ˆCUDA 12.4ï¼‰
pip3 install torch==2.5.0 torchvision==0.20.0 torchaudio==2.5.0 --index-url https://download.pytorch.org/whl/cu121

# å®‰è£…é¢å¤–ä¾èµ–é¡¹
pip3 install git+https://github.com/huggingface/transformers qwen-vl-utils[decord]
pip3 install git+https://github.com/huggingface/diffusers
pip3 install xfuser -i https://pypi.org/simple
pip3 install flash-attn==2.5.0 --no-build-isolation
pip3 install -e .
pip3 install nvidia-cublas-cu12==12.4.5.8

export PYTHONPATH=./
```

## ğŸ§± ä¸‹è½½æ¨¡å‹

åœ¨è®­ç»ƒæˆ–æ¨ç†å‰ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹ï¼š

| æ¨¡å‹ | åˆ†è¾¨ç‡ | ä¸‹è½½é“¾æ¥ | è¯´æ˜ |
|-------|-----------|----------------|-------|
| **Wan2.1-T2V-14B** | 480P & 720P | ğŸ¤— [Huggingface](https://huggingface.co/Wan-AI/Wan2.1-T2V-14B) <br> ğŸ¤– [ModelScope](https://www.modelscope.cn/models/Wan-AI/Wan2.1-T2V-14B) | æ–‡æœ¬ç”Ÿæˆè§†é¢‘æ¨¡å‹ |
| **Wan2.1-I2V-14B-720P** | 720P | ğŸ¤— [Huggingface](https://huggingface.co/Wan-AI/Wan2.1-I2V-14B-720P) <br> ğŸ¤– [ModelScope](https://www.modelscope.cn/models/Wan-AI/Wan2.1-I2V-14B-720P) | å›¾åƒç”Ÿæˆè§†é¢‘ï¼ˆé«˜åˆ†è¾¨ç‡ï¼‰ |
| **Wan2.1-I2V-14B-480P** | 480P | ğŸ¤— [Huggingface](https://huggingface.co/Wan-AI/Wan2.1-I2V-14B-480P) <br> ğŸ¤– [ModelScope](https://www.modelscope.cn/models/Wan-AI/Wan2.1-I2V-14B-480P) | å›¾åƒç”Ÿæˆè§†é¢‘ï¼ˆæ ‡å‡†ï¼‰ |

é¦–å…ˆï¼Œç¡®ä¿å·²å®‰è£…huggingface CLIæˆ–modelscope CLIã€‚
```
pip install -U "huggingface_hub[cli]"
pip install modelscope
```
ç„¶åï¼Œä¸‹è½½é¢„è®­ç»ƒçš„DiTå’ŒVAEæ£€æŸ¥ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†720P I2Vä»»åŠ¡çš„WAN2.1æ£€æŸ¥ç‚¹ä¸‹è½½åˆ°é»˜è®¤çš„```./weights```ç›®å½•ã€‚
```
hf download Wan-AI/Wan2.1-I2V-14B-720P --local-dir ./weights
```

## ğŸ“ è®­ç»ƒ

### 1ï¸âƒ£ å•GPUæ•°æ®é¢„å¤„ç†
```bash
python3 scripts/preprocess/gen_wanx_latent.py --config configs/pre_480.yaml
```

æˆ‘ä»¬åœ¨```temp_data/videos```ä¸­æä¾›äº†å‡ ä¸ªè§†é¢‘ä½œä¸ºæ¨¡æ¿è®­ç»ƒæ•°æ®ï¼Œä»¥åŠç”¨äºé¢„å¤„ç†çš„è¾“å…¥jsonæ–‡ä»¶```temp_data/temp_input_data.json```æ¨¡æ¿ã€‚```configs/pre_480.yaml```ç”¨äº480Pæ½œåœ¨æå–ï¼Œ```configs/pre_720.yaml```ç”¨äº720Pã€‚é…ç½®æ–‡ä»¶ä¸­çš„```json_path```å’Œ```save_dir```å¯ä»¥æ ¹æ®è‡ªå·±çš„è®­ç»ƒæ•°æ®è‡ªå®šä¹‰ã€‚

### 2ï¸âƒ£ æ•°æ®æ ‡æ³¨å’Œæ ¼å¼è½¬æ¢

å¥–åŠ±æ¨¡å‹çš„æ ‡æ³¨ï¼ˆä¾‹å¦‚```"physics_quality": 1, "human_quality": 1```ï¼‰åº”æ·»åŠ åˆ°æ•°æ®å…ƒæ–‡ä»¶ä¸­ï¼ˆä¾‹å¦‚```temp_data/480/meta_v1/0004e625d5bcb80130e1ea3d204e2488_meta_v1.json```ï¼‰ã€‚è¿™æ ·æˆ‘ä»¬å¾—åˆ°å…ƒæ–‡ä»¶åˆ—è¡¨```temp_data/temp_data_480.list```å’Œ```temp_data/temp_data_720.list```ï¼Œå¯ç”¨äºPAVRMå’ŒPRFLè®­ç»ƒã€‚

### 3ï¸âƒ£ å¤šGPUå¹¶è¡ŒPAVRMè®­ç»ƒ

ä¾‹å¦‚ï¼Œè¦ä½¿ç”¨8ä¸ªGPUè®­ç»ƒPAVRMï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ã€‚

```bash
torchrun --nnodes=1 --nproc_per_node=8 --master_port 29500 scripts/pavrm/train_pavrm.py --config configs/train_pavrm_i2v_720.yaml
```

é…ç½®æ–‡ä»¶ä¸­çš„```meta_file_list```å’Œ```val_meta_file_list```å¯ä»¥æ ¹æ®è‡ªå·±çš„è®­ç»ƒå’ŒéªŒè¯æ•°æ®è‡ªå®šä¹‰ã€‚æˆ‘ä»¬ä¸ºä¸åŒè®¾ç½®ï¼ˆt2væˆ–i2vï¼Œ480Pæˆ–720Pï¼‰æä¾›äº†å‡ ä¸ªé…ç½®æ–‡ä»¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ceæŸå¤±è®­ç»ƒPAVRMã€‚è¦ä½¿ç”¨btæŸå¤±è®­ç»ƒPAVRMï¼Œå¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶```configs/train_pavrm_bt_i2v_720.yaml```ã€‚

### 4ï¸âƒ£ å¤šGPUå¹¶è¡ŒPRFLè®­ç»ƒ

```bash
torchrun --nnodes=1 --nproc_per_node=8 --master_port 29500 scripts/prfl/train_prfl.py --config configs/train_prfl_i2v_720.yaml
```

é…ç½®æ–‡ä»¶ä¸­çš„```meta_file_list```å¯ä»¥æ ¹æ®è‡ªå·±çš„è®­ç»ƒæ•°æ®è‡ªå®šä¹‰ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„```lrm_transformer_path```ã€```lrm_mlp_path```å’Œ```lrm_query_attention_path```ç”¨äºä»ä¸Šä¸€æ­¥è·å¾—çš„å¥–åŠ±æ¨¡å‹ã€‚æˆ‘ä»¬ä¸ºä¸åŒè®¾ç½®ï¼ˆt2væˆ–i2vï¼Œ480Pæˆ–720Pï¼‰æä¾›äº†å‡ ä¸ªé…ç½®æ–‡ä»¶ã€‚

## ğŸš€ æ¨ç†

### 1ï¸âƒ£ å¤šGPUå¹¶è¡ŒPAVRMæ¨ç†

```bash
torchrun --nnodes=1 --nproc_per_node=8 --master_port 29500 scripts/pavrm/inference_pavrm.py --config configs/infer_pavrm_i2v_720.yaml
```

é…ç½®æ–‡ä»¶ä¸­çš„```val_meta_file_list```å¯ä»¥æ ¹æ®è‡ªå·±çš„æ¨ç†æ•°æ®è‡ªå®šä¹‰ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„```resume_transformer_path```ã€```resume_mlp_path```å’Œ```resume_query_attention_path```ç”¨äºå¾…æµ‹è¯•çš„å¥–åŠ±æ¨¡å‹ã€‚

### 2ï¸âƒ£ å¤šGPUå¹¶è¡ŒPRFLæ¨ç†

PRFLæ¨ç†ä¸å…¶åŸºç¡€æ¨¡å‹ï¼ˆä¾‹å¦‚Wan2.1ï¼‰å®Œå…¨ç›¸åŒã€‚

```bash
export negative_prompt="è‰²è°ƒè‰³ä¸½ï¼Œè¿‡æ›ï¼Œé™æ€ï¼Œç»†èŠ‚æ¨¡ç³Šä¸æ¸…ï¼Œå­—å¹•ï¼Œé£æ ¼ï¼Œä½œå“ï¼Œç”»ä½œï¼Œç”»é¢ï¼Œé™æ­¢ï¼Œæ•´ä½“å‘ç°ï¼Œæœ€å·®è´¨é‡ï¼Œä½è´¨é‡ï¼ŒJPEGå‹ç¼©æ®‹ç•™ï¼Œä¸‘é™‹çš„ï¼Œæ®‹ç¼ºçš„ï¼Œå¤šä½™çš„æ‰‹æŒ‡ï¼Œç”»å¾—ä¸å¥½çš„æ‰‹éƒ¨ï¼Œç”»å¾—ä¸å¥½çš„è„¸éƒ¨ï¼Œç•¸å½¢çš„ï¼Œæ¯å®¹çš„ï¼Œå½¢æ€ç•¸å½¢çš„è‚¢ä½“ï¼Œæ‰‹æŒ‡èåˆï¼Œé™æ­¢ä¸åŠ¨çš„ç”»é¢ï¼Œæ‚ä¹±çš„èƒŒæ™¯ï¼Œä¸‰æ¡è…¿ï¼ŒèƒŒæ™¯äººå¾ˆå¤šï¼Œå€’ç€èµ°"
torchrun --nnodes=1 --nproc_per_node=8 --master_port 29500 scripts/prfl/inference_prfl.py \
    --dit_fsdp \
    --t5_fsdp \
    --ulysses_size 1 \
    --task "i2v-14B"\
    --ckpt_dir "weights/Wan2.1-I2V-14B-720P" \
    --lora_path "" \
    --lora_alpha 0 \
    --dataset_path "temp_data/temp_prfl_infer_data.json" \
    --negative_prompt "$negative_prompt" \
    --size "1280*720" \
    --frame_num 81 \
    --sample_steps 40 \
    --sample_guide_scale 5.0 \
    --sample_shift 5.0 \
    --teacache_thresh 0 \
    --save_folder outputs/infer/prfl_i2v_720 \
    --transformer_path <YOUR_CKPT_PATH> \
    --offload_model False
```

**å‚æ•°è¯´æ˜:**
- `--dit_fsdp` `--t5_fsdp`: å¯ç”¨FSDPä»¥æé«˜å†…å­˜æ•ˆç‡
- `--task`: "t2v-14B"æˆ–"i2v-14B"
- `--ckpt_dir`: é¢„è®­ç»ƒæ£€æŸ¥ç‚¹æ–‡ä»¶è·¯å¾„
- `--lora_path` `--lora_alpha`: LoRAæ£€æŸ¥ç‚¹æ–‡ä»¶è·¯å¾„å’ŒåŠ è½½æƒé‡æ¯”ä¾‹
- `--dataset_path`: æ¨ç†æ•°æ®é›†æ–‡ä»¶è·¯å¾„
- `--size`: è¾“å‡ºåˆ†è¾¨ç‡ï¼ˆ"1280\*720"æˆ–"832\*480"ï¼‰
- `--frame_num`: ç”Ÿæˆçš„å¸§æ•°ï¼ˆé»˜è®¤ï¼š81ï¼‰
- `--sample_steps`: æ¨ç†æ­¥æ•°ï¼ˆé»˜è®¤ï¼š40ï¼‰
- `--sample_guide_scale`: æ— åˆ†ç±»å™¨å¼•å¯¼æ¯”ä¾‹ï¼ˆé»˜è®¤ï¼š5.0ï¼‰
- `--sample_shift`: æµåç§»ï¼ˆé»˜è®¤ï¼š5.0ï¼‰
- `--save_folder`: ä¿å­˜ç”Ÿæˆè§†é¢‘çš„è·¯å¾„
- `--teacache_thresh`: å¯ç”¨teacache
- `--transformer_path`: PRFLæ£€æŸ¥ç‚¹æ–‡ä»¶è·¯å¾„
- `--offload_model`: å¸è½½åˆ°CPUä»¥èŠ‚çœGPUå†…å­˜

## ğŸ“ å¼•ç”¨

å¦‚æœæ‚¨å‘ç°**HY-Video-PRFL**å¯¹æ‚¨çš„ç ”ç©¶æœ‰ç”¨ï¼Œè¯·å¼•ç”¨ï¼š
```bibtex
@article{mi2025video,
  title={Video Generation Models are Good Latent Reward Models},
  author={Mi, Xiaoyue and Yu, Wenqing and Lian, Jiesong and Jie, Shibo and Zhong, Ruizhe and Liu, Zijun and Zhang, Guozhen and Zhou, Zixiang and Xu, Zhiyong and Zhou, Yuan and Lu, Qinglin and Tang, Fan},
  journal={arXiv preprint arXiv:2511.21541},
  year={2025}
}
```

## ğŸ™ è‡´è°¢

æˆ‘ä»¬çœŸè¯šæ„Ÿè°¢ä»¥ä¸‹é¡¹ç›®çš„è´¡çŒ®è€…ï¼š
- [HunyuanVideo](https://github.com/Tencent/HunyuanVideo)
- [Wan2.1](https://github.com/Wan-Video/Wan2.1)
- [ImageReward](https://github.com/THUDM/ImageReward)
- [Diffusers](https://github.com/huggingface/diffusers)
- [HuggingFace](https://huggingface.co)
- [DeepSpeed](https://github.com/deepspeedai/DeepSpeed)

---

<div align="center">
  
**å¦‚æœæ‚¨è§‰å¾—æœ‰å¸®åŠ©ï¼Œè¯·ç»™è¿™ä¸ªä»“åº“åŠ æ˜Ÿ â­ï¼**

</div>
